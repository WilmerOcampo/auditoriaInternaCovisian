<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head th:replace="layoutlider::head">
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<style>
    .border-blue {
        border: 1px solid blue !important; /* !important asegura que esta regla tenga prioridad */
    }
</style>
<body>
<nav th:replace="layoutlider::menu"></nav>
<section class="dashboard">
    <div th:replace="layoutlider::top"></div>
    <div class="dash-content">
        <div class="overview">
            <form class="row g-3">
                <div class="border mb-3 p-3">
                    <h5 class="card-title"><span id="nombreCompleto">Bienvenido, [[${session.apellido}]]</span></h5>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-floating mb-3 mt-3">
                                <input type="number" class="form-control" name="dni" id="dni"
                                       th:value="${user.dni}" readonly>
                                <label for="dni">Documento Nacional de Identidad</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" name="nombre" id="nombre"
                                       th:value="${user.nombre}" readonly>
                                <label for="nombre">Nombre</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" name="apellido" id="apellido"
                                       th:value="${user.apellido}" readonly>
                                <label for="apellido">Apellido</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" id="area"
                                       th:value="${user.area}" readonly>
                                <label for="area">Area</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" id="username"
                                       th:value="${user.username}" readonly>
                                <label for="username">Username</label>
                            </div>
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="form-floating mb-3">
                                        <input type="password" value="password" class="form-control"  readonly>
                                        <label for="username">Contraseña</label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <a class="btn btn-info" id="cambiarContraseña">Cambiar Contraseña</a>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4 text-center">
                            <button id="editarBtn" type="button" class="btn btn-primary">Editar</button>
                            <button id="cancelarBtn" type="button" class="btn btn-secondary"
                                    style="display: none;">
                                Cancelar
                            </button>
                            <button id="guardarBtn" type="buttons" class="btn btn-success"
                                    style="display: none;">Guardar
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="modal fade modal-xl" id="miModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Restauracion de Contraseña</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                   <form class="was-validated">
                       <div class="form-floating mb-3">
                           <input type="text" class="form-control" required id="contraseñaactualizar" name="password">
                           <label for="contraseñaactualizar">Password</label>
                           <div class="invalid-feedback">
                               Porfavor colocar tu nueva contraseña.
                           </div>
                       </div>
                       <input type="hidden" th:value="${user.username}" id="usernameid" name="username">
                       <button type="submit" id="actionPassword" class="btn btn-primary">Cambiar</button>
                   </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <script th:src="@{/js/web/backoffice/lider/inicio.js}" type="text/javascript"></script>
    <script>
        $(document).ready(function () {
            $("#editarBtn").click(function () {
                elementoseditar(true);
                $("#nombre, #apellido").addClass("border-blue");
            });
            $("#cancelarBtn").click(function () {
                elementoseditar(false);
                $("#nombre, #apellido").removeClass("border-blue");
            });
            $("#cambiarContraseña").click(function (event) {
                $('#miModal').modal('show');
            });


            $("#actionPassword").click(function (event) {
                event.preventDefault();
                var username = $('#usernameid').val();
                var password = $('#contraseñaactualizar').val();
                $.ajax({
                   url: '/user/cambiarContrasenia',
                   type: 'POST',
                   data: {
                        username: username,
                        password: password
                   },
                   dataType: 'json',
                   success: function(response){
                        $('#miModal').modal('hide');
                   },
                   error: function(){
                    console.log('Error al actualizar la contraseña');
                   }
                });
                $('#miModal').modal('hide');
            });
            $("#guardarBtn").click(function (event) {
                var dni = $('#dni').val();
                var nombre = $('#nombre').val();
                var apellido = $('#apellido').val();
                $.ajax({
                    url : '/user/actualizar',
                    type : 'POST',
                    data : {
                        dni: dni,
                        nombre: nombre,
                        apellido: apellido
                    },
                    dataType: 'json',
                    success: function(response){
                        $.ajax({
                            url: '/user/prueba',
                            type: 'GET',
                            dataType: 'json',
                            success: function (datos){
                                $('#dni').val(datos.dni);
                                $('#nombre').val(datos.nombre);
                                $('#apellido').val(datos.apellido);
                                $('#area').val(datos.area);
                                $('#username').val(datos.username);
                                $('#nombreCompleto').text(datos.nombre + " " + datos.apellido);
                                elementoseditar(false);
                                $("#nombre, #apellido").removeClass("border-blue");
                            }
                        });
                    }
                });
            });
            function elementoseditar(edicionActivada) {
                $("#nombre, #apellido").prop("readonly", !edicionActivada);
                $("#guardarBtn").toggle(edicionActivada);
                $("#editarBtn").toggle(!edicionActivada);
                $("#cancelarBtn").toggle(edicionActivada);
            }

        });
    </script>
</section>
</body>
</html>